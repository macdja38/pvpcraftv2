{"version":3,"sources":["../../src/utils/MusicPlayer.js"],"names":["MusicPlayer","constructor","adapter","guild","text","voice","queue","musicDB","music","_adapter","_musicDB","repeat","length","init","id","then","play","saveQueue","guild_name","name","text_id","voice_id","addListeners","connection","oldConnection","removeListeners","on","onEnd","bind","onWarn","onDebug","removeListener","args","console","error","lastVideo","shift","push","channel","joinVoiceChannel","add","video","log","url","getStreamUrl","getCachingInfoLink","link","encoderArgs","pause"],"mappings":"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","file":"MusicPlayer.js","sourcesContent":["/**\r\n * Created by macdja38 on 2016-11-26.\r\n */\r\n\"use strict\";\r\nimport \"babel-core/register\";\r\nimport \"source-map-support/register\";\r\n\r\nexport class MusicPlayer{\r\n  constructor(adapter, guild, text, voice, queue, musicDB, music) {\r\n    this._adapter = adapter;\r\n    this._musicDB = musicDB;\r\n    this.music = music;\r\n    this.guild = guild;\r\n    this.text = text;\r\n    this.voice = voice;\r\n    this.queue = queue;\r\n    this.repeat = false;\r\n    if(queue && queue.length > 0) {\r\n      this.init(voice.id).then(()=>{\r\n        this.play();\r\n      })\r\n    }\r\n  }\r\n\r\n  saveQueue() {\r\n    this._musicDB.saveQueue({\r\n      id: this.guild.id,\r\n      guild_name: this.guild.name,\r\n      text: this.text.name,\r\n      text_id: this.text.id,\r\n      voice: this.voice.name,\r\n      voice_id: this.voice.id,\r\n    }, this.queue)\r\n  }\r\n\r\n  addListeners(connection, oldConnection) {\r\n    if (oldConnection) {\r\n      this.removeListeners(oldConnection);\r\n    }\r\n    connection.on(\"end\", this.onEnd.bind(this));\r\n    connection.on(\"warn\", this.onWarn.bind(this));\r\n    connection.on(\"debug\", this.onDebug.bind(this));\r\n  }\r\n\r\n  removeListeners(oldConnection) {\r\n    oldConnection.removeListener(\"end\", this.onEnd);\r\n    oldConnection.removeListener(\"warn\", this.onWarn);\r\n    oldConnection.removeListener(\"debug\", this.onDebug());\r\n  }\r\n\r\n  onEnd(...args) {\r\n    console.error(...args);\r\n    let lastVideo = this.queue.shift();\r\n    if(this.repeat) this.queue.push(lastVideo);\r\n    if(this.queue.length > 0) {\r\n      this.play();\r\n    }\r\n  }\r\n\r\n  onWarn(...args) {\r\n    console.error(\"Warn\", ...args);\r\n  }\r\n\r\n  onDebug(...args) {\r\n    console.error(\"Debug\", ...args);\r\n  }\r\n\r\n  async init(channel) {\r\n    return this._adapter.joinVoiceChannel(channel).then(connection => {\r\n      let oldConnection = this.connection;\r\n      this.connection = connection;\r\n      this.addListeners(connection, oldConnection);\r\n    });\r\n  }\r\n\r\n  add(video) {\r\n    this.queue.push(video);\r\n    this.saveQueue();\r\n  }\r\n\r\n  async play() {\r\n    if (this.queue.length > 0) {\r\n      console.log(\"queue\", this.queue);\r\n      let url = this.music.getStreamUrl(await this.music.getCachingInfoLink(this.queue[0].link));\r\n      console.log(url);\r\n      this.connection.play(url.url, {encoderArgs: [\"-c\", \"copy\"]});\r\n    }\r\n  }\r\n\r\n  pause() {\r\n\r\n  }\r\n}\r\n\r\nexport default MusicPlayer;\r\n"]}