{"version":3,"sources":["../../src/adapters/Discordjs.js"],"names":["DiscordjsAdapter","constructor","configJSON","adapterSettings","_configJSON","_adapterSettings","_client","Client","name","login","on","console","error","e","auth","token","startEvents","log","user","username","message","_commandHandler","onMessage","DiscordjsMessage","author","content","adapter","member","DiscordjsMember","_message","guild","DiscordjsGuild","DiscordjsUser","_guild","highestRole","members","find","_user","id","replace","roles","reduce","prev","role","position"],"mappings":"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","file":"Discordjs.js","sourcesContent":["/**\r\n * Created by macdja38 on 2016-09-18.\r\n */\r\n\r\n\"use strict\";\r\n\r\nimport Adapter from \"./Adapter\";\r\nimport Discord from \"discord.js\";\r\nimport Message from \"../events/Message\";\r\nimport Guild from \"../events/Guild\";\r\nimport User from \"../events/User\";\r\n\r\nexport default class DiscordjsAdapter extends Adapter {\r\n  constructor({configJSON, adapterSettings}) {\r\n    super();\r\n    //noinspection JSUnresolvedVariable\r\n    this._configJSON = configJSON;\r\n    this._adapterSettings = adapterSettings;\r\n    this._client = new Discord.Client();\r\n  }\r\n\r\n  static get name() {\r\n    return \"discordjs\";\r\n  }\r\n\r\n  async login() {\r\n    this._client.on(\"error\", e => console.error(\"Discordjs error\", e));\r\n    await this._client.login(this._adapterSettings.auth.token);\r\n    this.startEvents();\r\n  }\r\n\r\n  startEvents() {\r\n    this._client.on(\"ready\", () => {\r\n      /* eslint-disable */\r\n      console.log(`Connected as: ${this._client.user.username}`);\r\n      /* eslint-enable */\r\n    });\r\n\r\n    this._client.on(\"message\", message => {\r\n      this._commandHandler.onMessage(new DiscordjsMessage(message));\r\n      console.log(`discordjs ${this._client.user.username} ${message.author.username} ${message.content}`);\r\n    });\r\n  }\r\n}\r\n\r\nclass DiscordjsMessage extends Message {\r\n  constructor(message) {\r\n    super(message);\r\n  }\r\n\r\n  get adapter() {\r\n    return \"discordjs\"\r\n  }\r\n\r\n  get member() {\r\n    return new DiscordjsMember(this._message.author, this._message.guild);\r\n  }\r\n\r\n  get guild() {\r\n    return new DiscordjsGuild(this._message.guild);\r\n  }\r\n\r\n  get content() {\r\n    return this._message.content;\r\n  }\r\n\r\n  get author() {\r\n    return new DiscordjsUser(this._message.author);\r\n  }\r\n}\r\n\r\nclass DiscordjsGuild extends Guild {\r\n  constructor(guild) {\r\n    super(guild);\r\n  }\r\n}\r\n\r\nclass DiscordjsUser extends User {\r\n  constructor(user) {\r\n    super(user);\r\n  }\r\n}\r\n\r\nclass DiscordjsMember extends DiscordjsUser {\r\n  constructor(user, guild) {\r\n    super(user);\r\n    this._guild = guild;\r\n  }\r\n\r\n  get highestRole() {\r\n    return this._guild.members.find(\"id\", this._user.id).highestRole.name.replace(/@/g, \"AT\");\r\n  }\r\n\r\n  get highestRole() {\r\n    return this.roles.reduce((prev, role) =>\r\n      !prev || role.position > prev.position ||(role.position === prev.position && role.id < prev.id) ? role : prev);\r\n  }\r\n}\r\n\r\n"]}